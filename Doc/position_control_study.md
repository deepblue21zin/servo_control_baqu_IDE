### 1. í¬ê¸°ê°€ ëª…í™•í•œ ì •ìˆ˜í˜•ì„ ì“°ëŠ” ì´ìœ 

ì¼ë°˜ ì •ìˆ˜í˜•ì˜ ë¬¸ì œì 
int x; //ëª‡ ë°”ì´íŠ¸? -> ì»´íŒŒì¼ëŸ¬/í”Œë«í¼ë§ˆë‹¤ ë‹¤ë¥´ë‹¤
- PC(64bit) : int = 4ë°”ì´íŠ¸
- ì˜›ë‚  MCU : int = 2ë°”ì´íŠ¸
- íƒ€ì´ë¨¸ ë ˆì§€ìŠ¤í„° : ì •í™•íˆ 32ë¹„íŠ¸ ìš”êµ¬

stdint.hì˜ í•´ê²°ì±…
uint32_t time_ms; //ë¬´ì¡°ê±´ 32ë¹„íŠ¸
int16_t sensor; //ë¬´ì¡°ê±´ 16ë¹„íŠ¸

ì„ë² ë””ë“œì—ì„œ í•„ìˆ˜ì¸ ì´ìœ :
- í•˜ë“œì›¨ì–´ ë ˆì§€ìŠ¤í„° ì ‘ê·¼ : íƒ€ì´ë¨¸, ADCëŠ” ì •í™•í•œ ë¹„íŠ¸ í¬ê¸° ìš”êµ¬
- ë©”ëª¨ë¦¬ ì ˆì•½ : RAM ë¶€ì¡±í•œ MCUì—ì„œ ë¶ˆí•„ìš”í•œ ë‚­ë¹„ ë°©ì§€
- ì´ì‹ì„± : ë‹¤ë¥¸ MCUë¡œ ì½”ë“œ ì˜®ê²¨ë„ ë™ì‘ ë³´ì¥
uint32_t current_time = HAL_GetTick(); //íƒ€ì„ ë§¤ì¹­
int time = HAL_GetTick(); //í¬ê¸° ë¶ˆëª…í™•

## 2. staticê³¼ struct ê°œë…
struct(êµ¬ì¡°ì²´) - ë°ì´í„° ë¬¶ìŒ
ê¸°ë³¸ ê°œë…:
float target;
float current;
float error;

sturct MotorState{
    float target;
    float current;
    float error;
};
ì‹¤ì œ ì‚¬ìš©
//1. íƒ€ì„ ì •ì˜
typedef struct{
    float target;
    float current;
} MotorState_t;
//2. ë³€ìˆ˜ ì„ ì–¸
MotorState_t motor1;
MotorState_t motor2;
//3. ì ‘ê·¼
motor1.target = 90.0f;
motor1.current = 45.5f;

ì™œ ì“°ë‚˜?
- ê´€ë ¨ ë°ì´í„°ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ê·¸ë£¹í™”
- í•¨ìˆ˜ íŒŒë¼ë¯¸í„°ë¡œ í•œ ë²ˆì— ì „ë‹¬
- ì½”ë“œ ê°€ë…ì„± í–¥ìƒ

ex)
// êµ¬ì¡°ì²´ ì—†ì´
void SetMotor(float target, float current, float error, bool stable);

// êµ¬ì¡°ì²´ ì‚¬ìš©
void SetMotor(MotorState_t state);  // ê¹”ë”!

### static - ì ‘ê·¼ ë²”ìœ„ ì œí•œ
Cì—ì„œ ë³€ìˆ˜ì˜ ìŠ¤ì½”í”„:

int global_var = 100; //ëª¨ë“  íŒŒì¼ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥(ìœ„í—˜)
static int private_var = 50; //ì´ íŒŒì¼ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥

staticì˜ ë‘ê°€ì§€ ì—­í• :
1. íŒŒì¼ ìŠ¤ì½”í”„ ì œí•œ(ì£¼ë¡œ ì´ìš©)
// position_control.c
static float pid_output;  // ì´ íŒŒì¼ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©

// main.c
extern float pid_output;  // âŒ ì»´íŒŒì¼ ì—ëŸ¬! ì ‘ê·¼ ë¶ˆê°€

2. í•¨ìˆ˜ ë‚´ ì •ì  ë³€ìˆ˜(ë©”ëª¨ë¦¬ ìœ ì§€)
void CountCalls(void) {
    static int count = 0;  // í•¨ìˆ˜ ì¢…ë£Œí•´ë„ ê°’ ìœ ì§€
    count++;
    printf("Called %d times\n", count);
}

CountCalls();  // Called 1 times
CountCalls();  // Called 2 times (ê°’ì´ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ!)

//ì½”ë“œì—ì„œì˜ ì ìš© ì˜ˆì‹œ
// position_control.c

// â­ static êµ¬ì¡°ì²´ - ì´ íŒŒì¼ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
static struct {
    float prev_error;
    float integral;
    uint32_t last_time_ms;
} pid_state = {0};  // ëª¨ë“  ë©¤ë²„ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”
```

**êµ¬ì¡°:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pid_state (êµ¬ì¡°ì²´ ë³€ìˆ˜)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  .prev_error    = 0.0f          â”‚
â”‚  .integral      = 0.0f          â”‚
â”‚  .last_time_ms  = 0             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
stacitì„ ì“´ ì´ìœ :
- main.cë‚˜ ë‹¤ë¥¸ íŒŒì¼ì—ì„œ pid_state.integralì„ ì§ì ‘ ìˆ˜ì •í•˜ë©´ ì œì–´ê°€ ë§ê°€ì§
- í•¨ìˆ˜ (positionControl_Reset())ë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼í•˜ë„ë¡ ê°•ì œ

ìº¡ìŠí™” ê°œë…:
// âŒ ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ (ë¶ˆê°€ëŠ¥)
pid_state.integral = 999999.0f;  // ì»´íŒŒì¼ ì—ëŸ¬

// âœ… í•¨ìˆ˜ë¥¼ í†µí•œ ì•ˆì „í•œ ì ‘ê·¼
PositionControl_Reset();  // ë‚´ë¶€ì—ì„œ ì•ˆì „í•˜ê²Œ ì´ˆê¸°í™”
```

### PIDì œì–´ ê°œë…

### ê¸°ë³¸ ì›ë¦¬

**ë¬¸ì œ ìƒí™©:**
```
ëª©í‘œ: 90ë„
í˜„ì¬: 30ë„
â†’ ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ/ì„¸ê²Œ ëª¨í„°ë¥¼ ëŒë ¤ì•¼ í• ê¹Œ?



### PIDì˜ ì„¸ê°€ì§€ ì ‘ê·¼:
## P(ë¹„ë¡€ ì œì–´) - í˜„ì¬ ì˜¤ì°¨ì— ë°˜ì‘
error = target - current;  // 90 - 30 = 60ë„
P_output = Kp Ã— error;     // 500 Ã— 60 = 30,000 Hz
```

**íŠ¹ì§•:**
- ì˜¤ì°¨ê°€ í¬ë©´ ê°•í•˜ê²Œ, ì‘ìœ¼ë©´ ì•½í•˜ê²Œ
- ë¬¸ì œ: ëª©í‘œì— ê°€ê¹Œì›Œì§€ë©´ í˜ì´ ì•½í•´ì ¸ì„œ ì •í™•íˆ ë„ë‹¬ ëª»í•¨ (ì •ìƒìƒíƒœ ì˜¤ì°¨)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pë§Œ ì‚¬ìš©í•œ ê²½ìš°              â”‚
â”‚                              â”‚
â”‚  90Â° â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ(ëª©í‘œ)     â”‚
â”‚  85Â° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (ì—¬ê¸°ì„œ ë©ˆì¶¤)â”‚
â”‚  30Â° â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## I(ì ë¶„ ì œì–´) - ëˆ„ì  ì˜¤ì°¨ í•´ê²°
integral += error Ã— dt;  // ì˜¤ì°¨ë¥¼ ê³„ì† ëˆ„ì 
I_output = Ki Ã— integral;

ë™ì‘ ì›ë¦¬:
- ëª©í‘œì— ë„ë‹¬ ëª»í•˜ê³  ìˆìœ¼ë©´ -> ì ë¶„ê°’ ì¦ê°€ -> ì¶œë ¥ ì¦ê°€
- ì²œì²œíˆ ìŒ“ì´ì§€ë§Œ ê²°êµ­ ëª©í‘œì— ë„ë‹¬

ë¬¸ì œì  - Integral Windup(ì ë¶„ ì™€ì¸ë“œì—…):
// ëª¨í„°ê°€ ë¬¼ë¦¬ì  í•œê³„(10,000 Hz)ì— ë„ë‹¬í–ˆëŠ”ë°
// ì˜¤ì°¨ê°€ ê³„ì† ìˆìœ¼ë©´ ì ë¶„ë§Œ ê³„ì† ì¦ê°€!

integral = 999999.0f;  // âš ï¸ í­ë°œ!

í•´ê²°ì±…
if (integral > 1000.0f) {
    integral = 1000.0f;  // ìƒí•œ ì œí•œ
}
## D(ë¯¸ë¶„ ì œì–´) - ê¸‰ê²©í•œ ë³€í™” ì–µì œ
derivative = (current_error - prev_error) / dt;  // ì˜¤ì°¨ì˜ ë³€í™”ìœ¨
D_output = Kd Ã— derivative;
```

**ì—­í• :**
- ëª©í‘œì— ë¹ ë¥´ê²Œ ì ‘ê·¼ â†’ Dí•­ì´ ë¸Œë ˆì´í¬ ì—­í• 
- ì˜¤ë²„ìŠ›(ëª©í‘œë¥¼ ë„˜ì–´ê°€ëŠ” í˜„ìƒ) ë°©ì§€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PD ì œì–´                      â”‚
â”‚                              â”‚
â”‚  90Â° â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ•®                â”‚
â”‚  85Â° â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€ (ë¶€ë“œëŸ½ê²Œ)  â”‚
â”‚  30Â° â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì½”ë“œì—ì„œì˜  PIDê³„ì‚°
static float PID_Calculate(float error, float dt) {
    // 1. Pí•­ - í˜„ì¬ ì˜¤ì°¨
    float p_term = pid_params.Kp * error;
    // error = 10ë„ â†’ P = 500 Ã— 10 = 5000 Hz
    
    // 2. Ií•­ - ëˆ„ì  ì˜¤ì°¨
    pid_state.integral += error * dt;
    // dt=0.001ì´ˆ, error=10 â†’ integral += 0.01
    
    // ì ë¶„ ì œí•œ (ì™€ì¸ë“œì—… ë°©ì§€)
    if (pid_state.integral > pid_params.integral_limit) {
        pid_state.integral = pid_params.integral_limit;
    }
    float i_term = pid_params.Ki * pid_state.integral;
    
    // 3. Dí•­ - ì˜¤ì°¨ ë³€í™”ìœ¨
    float derivative = (error - pid_state.prev_error) / dt;
    // ì´ì „ 15ë„, í˜„ì¬ 10ë„ â†’ (10-15)/0.001 = -5000ë„/ì´ˆ
    float d_term = pid_params.Kd * derivative;
    
    pid_state.prev_error = error;  // ë‹¤ìŒ ê³„ì‚°ì„ ìœ„í•´ ì €ì¥
    
    // 4. í•©ì‚°
    float output = p_term + i_term + d_term;
    
    // 5. ì¶œë ¥ ì œí•œ
    if (output > 10000.0f) output = 10000.0f;
    
    return output;
}
```

---

### ì‹¤ì œ ë™ì‘ ì˜ˆì‹œ
```
ì‹œê°„ | ëª©í‘œ | í˜„ì¬ | ì˜¤ì°¨ | Pí•­  | Ií•­ | Dí•­  | ì¶œë ¥
-----|------|------|------|------|-----|------|------
0ms  | 90Â°  | 30Â°  | 60Â°  | 30k  | 0   | 0    | 10kâš ï¸
10ms | 90Â°  | 50Â°  | 40Â°  | 20k  | 50  | -1k  | 10k
100ms| 90Â°  | 85Â°  | 5Â°   | 2.5k | 200 | -500 | 2.2k
200ms| 90Â°  | 89Â°  | 1Â°   | 500  | 250 | -100 | 650
300ms| 90Â°  | 90Â°  | 0Â°   | 0    | 0   | -200 | -200

### ì´ˆê¸°í™” ì´ìœ 
- ì œì–´ ì‹œì‘ ì „ ê¹¨ë—í•œ ìƒíƒœ ë³´ì¥
- integralì´ ì“°ë ˆê¸° ê°’ì´ë©´ ì œì–´ í­ì£¼ ê°€ëŠ¥
- prev_errorê°€ ì´ˆê¸°í™” ì•ˆë˜ë©´ ì²« Dí•­ ê³„ì‚° ì˜¤ë¥˜


### êµ¬ì´ˆì œ ì´ˆê¸°í™” ë°©ë²• ë¹„êµ
1. ìˆœì„œëŒ€ë¡œ ì´ˆê¸°í™”(ì˜›ë‚  ë°©ì‹)
// êµ¬ì¡°ì²´ ì •ì˜ (position_control.hì— ìˆì„ ê²ƒ)
typedef struct {
    float Kp;
    float Ki;
    float Kd;
    float integral_limit;
    float output_limit;
} PID_Params_t;

// ìˆœì„œëŒ€ë¡œ ì´ˆê¸°í™”
static PID_Params_t pid_params = {500.0f, 5.0f, 20.0f, 1000.0f, 10000.0f};

ë¬¸ì œì :
// âŒ ì´ê²Œ ë­ê°€ ë­”ì§€ ëª¨ë¥´ê² ìŒ!
static PID_Params_t pid_params = {500.0f, 5.0f, 20.0f, 1000.0f, 10000.0f};
// 500ì€ Kp? Ki? ìˆœì„œ ì™¸ìš°ê³  ìˆì–´ì•¼ í•¨!

// âŒ êµ¬ì¡°ì²´ ì •ì˜ê°€ ë°”ë€Œë©´ ë²„ê·¸!
typedef struct {
    float Kd;  // ìˆœì„œ ë³€ê²½!
    float Kp;
    float Ki;
    float integral_limit;
    float output_limit;
} PID_Params_t;

// ì´ì œ ì²« ë²ˆì§¸ ê°’ì´ Kdë¡œ ë“¤ì–´ê°! ğŸ’¥

2. Designated Initializer(ê¶Œì¥)
// ë©¤ë²„ëª…ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
static PID_Params_t pid_params = {
    .Kp = 500.0f,           // "Kp ë©¤ë²„ì— 500ì„ ë„£ì–´ë¼"
    .Ki = 5.0f,             // "Ki ë©¤ë²„ì— 5ë¥¼ ë„£ì–´ë¼"
    .Kd = 20.0f,
    .integral_limit = 1000.0f,
    .output_limit = 10000.0f
};

ì¥ì  :
1. ê°€ë…ì„± í–¥ìƒ
2. ìˆœì„œ ë¬´ê´€
3. êµ¬ì¡°ì²´ ë³€ê²½ì— ì•ˆì „
4. ì¼ë¶€ë§Œ ì´ˆê¸°í™” ê°€ëŠ¥

ì‹¤ì œ ë™ì‘ í™•ì¸
// êµ¬ì¡°ì²´ ì •ì˜
typedef struct {
    float Kp;
    float Ki;
    float Kd;
    float integral_limit;
    float output_limit;
} PID_Params_t;

// ì´ˆê¸°í™”
static PID_Params_t pid_params = {
    .Kp = 500.0f,
    .Ki = 5.0f,
    .Kd = 20.0f,
    .integral_limit = 1000.0f,
    .output_limit = 10000.0f
};

// ë©”ëª¨ë¦¬ êµ¬ì¡°
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pid_params              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ .Kp            = 500.0f â”‚ â† ì²« 4ë°”ì´íŠ¸
â”‚ .Ki            = 5.0f   â”‚ â† ë‹¤ìŒ 4ë°”ì´íŠ¸
â”‚ .Kd            = 20.0f  â”‚
â”‚ .integral_limit = 1000.0fâ”‚
â”‚ .output_limit  = 10000.0fâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// ì ‘ê·¼
float gain = pid_params.Kp;  // 500.0f

## ë¹„êµ ì˜ˆì‹œ
// âŒ ìˆœì„œ ë°©ì‹ - í—·ê°ˆë¦¼!
PID_Params_t p1 = {500.0f, 5.0f, 20.0f, 1000.0f, 10000.0f};

// âœ… Designated - ëª…í™•!
PID_Params_t p2 = {
    .Kp = 500.0f,
    .Ki = 5.0f,
    .Kd = 20.0f,
    .integral_limit = 1000.0f,
    .output_limit = 10000.0f
};

// íŠ¹íˆ ë©¤ë²„ê°€ ë§ì„ ë•Œ ì°¨ì´ ëª…í™•!
typedef struct {
    float a, b, c, d, e, f, g, h, i, j;
} Many_Members_t;

// âŒ ì´ê±´ ë­ê°€ ë­”ì§€...
Many_Members_t x = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

// âœ… ëª…í™•!
Many_Members_t y = {
    .a = 1,
    .e = 5,  // ì¼ë¶€ë§Œ ì´ˆê¸°í™”
    .j = 10
    // ë‚˜ë¨¸ì§€ëŠ” 0
};

### staticë³€ìˆ˜ì˜ íŠ¹ì„±
static struct {
    float prev_error;
    float integral;
    uint32_t last_time_ms;
} pid_state = {0};  // â† ì´ ì´ˆê¸°í™”ëŠ” ì–¸ì œ?
```

**ì»´íŒŒì¼ ì‹œì ì— ë”± 1ë²ˆë§Œ ì‹¤í–‰ë¨!**
```
í”„ë¡œê·¸ë¨ ì‹¤í–‰ íë¦„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì „ì› ì¼œì§                 â”‚
â”‚ 2. static ë³€ìˆ˜ ì´ˆê¸°í™”        â”‚ â† pid_state = {0} ì‹¤í–‰
â”‚ 3. main() ì‹œì‘               â”‚
â”‚ 4. Init() í˜¸ì¶œ               â”‚ â† pid_state.prev_error = 0.0f ì‹¤í–‰
â”‚ 5. ì œì–´ ë™ì‘                 â”‚
â”‚ 6. ë¦¬ì…‹ ë²„íŠ¼                 â”‚
â”‚ 7. Init() ë‹¤ì‹œ í˜¸ì¶œ          â”‚ â† pid_state.prev_error = 0.0f ë‹¤ì‹œ!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ 7ë²ˆì—ì„œ static ì´ˆê¸°í™”(= {0})ëŠ” ì‹¤í–‰ ì•ˆ ë¨!
## 3ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
1. ì„ ì–¸ì‹œ ì´ˆê¸°í™”ë§Œ
static struct {
    float prev_error;
    float integral;
    uint32_t last_time_ms;
} pid_state = {0};  // â† ì—¬ê¸°ë§Œ!

int PositionControl_Init(void) {
    // ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
    printf("Initialized\n");
    return POS_CTRL_OK;
}
ë¬¸ì œì  :
void main() {
    PositionControl_Init();
    PositionControl_Enable();
    // ... ì œì–´ ë™ì‘ (integralì´ 123.4fë¡œ ì¦ê°€) ...
    
    // ì—ëŸ¬! ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ìŒ
    PositionControl_Init();  // â† ì•„ë¬´ ì¼ë„ ì•ˆ ì¼ì–´ë‚¨!
    // integral = 123.4f ê·¸ëŒ€ë¡œ! ğŸ’¥
}
2. Init()ì—ì„œë§Œ ì´ˆê¸°í™”
static struct {
    float prev_error;
    float integral;
    uint32_t last_time_ms;
} pid_state;  // â† ì´ˆê¸°í™” ì•ˆ í•¨!

int PositionControl_Init(void) {
    pid_state.prev_error = 0.0f;
    pid_state.integral = 0.0f;
    pid_state.last_time_ms = HAL_GetTick();
}
ë¬¸ì œì :
// ë§Œì•½ Init()ì„ ê¹œë¹¡í•˜ê³  ì•ˆ ë¶ˆë €ë‹¤ë©´?
void main() {
    // PositionControl_Init();  // â† ê¹œë¹¡!
    PositionControl_Enable();
    PositionControl_Update();  // ì“°ë ˆê¸° ê°’ìœ¼ë¡œ ê³„ì‚°! ğŸ’¥
}
```

**ì“°ë ˆê¸° ê°’ ì˜ˆì‹œ:**
```
pid_state.prev_error = 0x4A3F2E1D (ëœë¤ ë©”ëª¨ë¦¬)
pid_state.integral   = 1.23456e+38 (ì—„ì²­ í° ê°’!)
3. ë‘˜ë‹¤(í˜„ì¬ ì½”ë“œ)
static struct {
    float prev_error;
    float integral;
    uint32_t last_time_ms;
} pid_state = {0};  // â† ì•ˆì „ì¥ì¹˜

int PositionControl_Init(void) {
    pid_state.prev_error = 0.0f;      // â† ì¬ì´ˆê¸°í™”
    pid_state.integral = 0.0f;
    pid_state.last_time_ms = HAL_GetTick();
}
ì¥ì :
// 1. Init() ê¹œë¹¡í•´ë„ ìµœì†Œí•œ 0
void main() {
    // PositionControl_Init();  // ê¹œë¹¡!
    PositionControl_Update();  // 0ìœ¼ë¡œ ì‹œì‘ (ì•ˆì „)
}

// 2. ì¬ì´ˆê¸°í™” ê°€ëŠ¥
void main() {
    PositionControl_Init();
    // ... ì‚¬ìš© ...
    PositionControl_Init();  // ë‹¤ì‹œ ë¦¬ì…‹ ê°€ëŠ¥!
}

// 3. ëŸ°íƒ€ì„ ê°’ ì„¤ì • ê°€ëŠ¥
pid_state.last_time_ms = HAL_GetTick();  // â† ì´ê±´ ì„ ì–¸ ì‹œ ë¶ˆê°€ëŠ¥!
//ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°
## ì´ìœ ?
- ì•ˆì „ : Init()ê¹œë¹¡í•´ë„ ì“°ë ˆê¸°ê°’ ë°©ì§€
- ëª…í™•ì„± : ì´ ì‹œìŠ¤í…œì€ ì´ë ‡ê²Œ ì´ˆê¸°í™” ëœë‹¤ ë¬¸ì„œí™”
- ìœ ì§€ë³´ìˆ˜ : ë‚˜ì¤‘ì— ì½”ë“œ ì½ì„ ë•Œ ì´í•´ ì‰¬ì›€
- ì¬ì‚¬ìš© : Resetê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥

## ì´ ì½”ë“œê°€ ë‘˜ë‹¤ í•˜ëŠ” ì´ìœ ?
- ={0} : ì“°ë ˆê¸°ê°’ ë°©ì§€(ì•ˆì „ ì¥ì¹˜)
- Init() : ì¬ì‹œì‘ ê°€ëŠ¥ + HAL_GetTick() ê°™ì€ ëŸ°íƒ€ì„ ê°’ ì„¤ì •


### ë©”ì¸ ì œì–´ ë£¨í”„
ì „ì²´ íë¦„ :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì œì–´ í™œì„±í™” ì²´í¬                  â”‚
â”‚ 2. ì—”ì½”ë”ì—ì„œ í˜„ì¬ ê°ë„ ì½ê¸°         â”‚
â”‚ 3. ì•ˆì „ ì²´í¬                         â”‚
â”‚ 4. ì˜¤ì°¨ ê³„ì‚°                         â”‚
â”‚ 5. ì‹œê°„ ê°„ê²©(dt) ê³„ì‚°                â”‚
â”‚ 6. PID ê³„ì‚°                          â”‚
â”‚ 7. ëª¨í„°ì— í„ìŠ¤ ì¶œë ¥                  â”‚
â”‚ 8. ì•ˆì •í™” íŒë‹¨                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## 1. ì œì–´ í™˜ê²½ ì²´í¬
if (!control_enabled) {
        PulseControl_Stop();
        return;
    }

conrol_enabled = falseë¡œ ì´ˆê¸°í™” í•˜ê¸° ë•Œë¬¸ì— 
## 2. í˜„ì¬ ê°ë„ ì½ê¸°
// 1. í˜„ì¬ ê°ë„ ì½ê¸°
    state.current_angle = EncoderReader_GetAngleDeg();
ë™ì‘ :
- EncoderReader_GetAngleDeg(): ì—”ì½”ë” ëª¨ë“ˆì˜ í•¨ìˆ˜
- í˜„ì¬ ì„œë³´ëª¨í„°ì˜ ì‹¤ì œ ê°ë„ë¥¼ ì½ì–´ì˜´
- state.current_angleì— ì €ì¥
// ì—”ì½”ë”ì—ì„œ ì½ì€ ê°’
float angle = EncoderReader_GetAngleDeg();  // 45.7ë„
state.current_angle = 45.7f;
```

**ì™œ ë§¤ë²ˆ ì½ë‚˜?**
```
ì‹œê°„ | ëª©í‘œ | ì—”ì½”ë” ì½ê¸° | í˜„ì¬ê°ë„ ì—…ë°ì´íŠ¸
-----|------|-------------|------------------
0ms  | 90Â°  | 30.0Â°       | 30.0Â° â†’ state
1ms  | 90Â°  | 30.5Â°       | 30.5Â° â†’ state
2ms  | 90Â°  | 31.2Â°       | 31.2Â° â†’ state
...
- ì‹¤ì‹œê°„ í”¼ë“œë°±
- ëª¨í„°ê°€ ì‹¤ì œë¡œ ì›€ì§ì¸ ë§Œí¼ ì¶”ì 

## 3. ì•ˆì „ ì²´í¬
// 2. ì•ˆì „ ì²´í¬
    if (!PositionControl_CheckSafety()) {
        PositionControl_EmergencyStop();  //ê¸´ê¸‰ ì •ì§€, ì œì–´ ë¹„í™œì„±í™”, ëª¨í„° ì¦‰ì‹œ ì¤‘ì§€
        return;
    }

ì•ˆì „ ì²´í¬ ë‚´ìš© :
bool PositionControl_CheckSafety(void) {
    // ê°ë„ ë²”ìœ„ ì´ˆê³¼?
    if (current_angle > MAX_ANGLE_DEG + 5.0f) return false;
    
    // ì˜¤ì°¨ê°€ ë„ˆë¬´ í°ê°€?
    if (fabsf(error) > 60.0f) return false;
    
    return true;  // ì•ˆì „!
}
ì‹¤ì œ ë™ì‘ :
// ì •ìƒ ë™ì‘
current_angle = 45.0Â°  â†’ CheckSafety() = true  â†’ ê³„ì† ì§„í–‰

// ìœ„í—˜ ìƒí™©
current_angle = 200.0Â° â†’ CheckSafety() = false â†’ ê¸´ê¸‰ì •ì§€! ğŸ’¥

## 4. ì˜¤ì°¨ ê³„ì‚°
// 3. ì˜¤ì°¨ ê³„ì‚°
    state.error = state.target_angle - state.current_angle;
```

**PIDì˜ ê¸°ë³¸:**
```
error = ëª©í‘œ - í˜„ì¬
ì˜ˆì‹œ :
state.target_angle = 90.0f;    // ì‚¬ìš©ìê°€ SetTarget()ìœ¼ë¡œ ì„¤ì •
state.current_angle = 30.0f;   // ì—”ì½”ë”ì—ì„œ ì½ìŒ

state.error = 90.0f - 30.0f;   // 60.0ë„
```

**ì˜¤ì°¨ì˜ ì˜ë¯¸:**
- **ì–‘ìˆ˜** (+60ë„): ëª©í‘œê°€ ë” í¼ â†’ ì•ìœ¼ë¡œ íšŒì „ í•„ìš”
- **ìŒìˆ˜** (-20ë„): í˜„ì¬ê°€ ë” í¼ â†’ ë’¤ë¡œ íšŒì „ í•„ìš”
- **0**: ëª©í‘œ ë„ë‹¬!

**ë™ì  ë³€í™”:**
```
ì‹œê°„ | ëª©í‘œ | í˜„ì¬ | ì˜¤ì°¨
-----|------|------|------
0ms  | 90Â°  | 30Â°  | +60Â°  (í¬ê²Œ ì•ìœ¼ë¡œ!)
10ms | 90Â°  | 50Â°  | +40Â°  (ì•„ì§ ì•ìœ¼ë¡œ)
50ms | 90Â°  | 85Â°  | +5Â°   (ê±°ì˜ ë‹¤ ì˜´)
100ms| 90Â°  | 90Â°  | 0Â°    (ë„ì°©!)

## 5. ì‹œê°„ ê°„ê²© ê³„ì‚°
// 4. ì‹œê°„ ê³„ì‚°
    uint32_t current_time = HAL_GetTick(); //1234

HAL_GetTick():
- STM32HALë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜
- ì‹œìŠ¤í…œ ë¶€íŒ… í›„ ê²½ê³¼ ì‹œê°„(ë°€ë¦¬ì´ˆ)
- 1msë§ˆë‹¤ 1ì”© ì¦ê°€

float dt = (current_time - pid_state.last_time_ms) / 1000.0f;  // ms â†’ s
```

**dt (Delta Time) ê³„ì‚°:**

**ìˆ˜ì‹:**
```
dt = (í˜„ì¬ì‹œê°„ - ì´ì „ì‹œê°„) / 1000

ë‹¨ìœ„ ë³€í™˜ :
current_time = 1235 ms
last_time_ms = 1234 ms

dt = (1235 - 1234) / 1000.0f
   = 1 / 1000.0f
   = 0.001 ì´ˆ

ì™œ 1000.0fë¡œ ë‚˜ëˆ„ë‚˜?
- ë°€ë¦¬ì´ˆ -> ì´ˆ ë³€í™˜
- 1000.0f : floatí˜• ë¦¬í„°ëŸ´(ì •í™•í•œ ë‚˜ëˆ—ì…ˆ)
- 1000 : intí˜•ì´ë©´ ì •ìˆ˜ ë‚˜ëˆ—ì…ˆ ë°œìƒ ê°€ëŠ¥

ì‹¤ì œ íƒ€ì´ë° ì˜¤ì°¨:
// ì´ìƒ: 1msë§ˆë‹¤ ì •í™•íˆ í˜¸ì¶œ
dt = 0.001, 0.001, 0.001, 0.001...

// í˜„ì‹¤: íƒ€ì´ë¨¸ ì˜¤ì°¨, ì¸í„°ëŸ½íŠ¸ ì§€ì—°
dt = 0.001, 0.0012, 0.0009, 0.0011...

## 6. PID ê³„ì‚°
// PID ê³„ì‚°
    state.output = PID_Calculate(state.error, dt);

í•¨ìˆ˜ í˜¸ì¶œ :
PID_Calculate(error, dt)

ì…ë ¥ :
- error = 60.0f (ëª©í‘œ-í˜„ì¬)
- dt = 0.001f(ì‹œê°„ ê°„ê²©)
ë‚´ë¶€ ë™ì‘
static float PID_Calculate(float error, float dt) {
    float p_term = Kp * error;              // 500 * 60 = 30000
    pid_state.integral += error * dt;       // ëˆ„ì 
    float i_term = Ki * integral;           // 5 * integral
    float derivative = (error - prev_error) / dt;
    float d_term = Kd * derivative;         // 20 * derivative
    
    float output = p_term + i_term + d_term;
    
    // ì¶œë ¥ ì œí•œ
    if (output > 10000.0f) output = 10000.0f;
    
    return output;  // ì˜ˆ: 8500 Hz
}

ë°˜í™˜ ê°’:
state.output = 8500.0f;  // í„ìŠ¤ ì£¼íŒŒìˆ˜ (Hz)

## 7. í„ìŠ¤ ì¶œë ¥
//  í„ìŠ¤ ì¶œë ¥
    PulseControl_SetFrequency((int32_t)state.output);

íƒ€ì… ë³€í™˜:
state.output = 8500.0f;           // float
(int32_t)state.output = 8500;     // int32_t
```

**PulseControl_SetFrequency():**
- ëª¨í„° ë“œë¼ì´ë²„ì— í„ìŠ¤ ì‹ í˜¸ ìƒì„±
- 8500 Hz = 1ì´ˆì— 8500ë²ˆ í„ìŠ¤
- ì£¼íŒŒìˆ˜ê°€ í´ìˆ˜ë¡ ëª¨í„° ë¹ ë¥´ê²Œ íšŒì „

**ë¬¼ë¦¬ì  ë™ì‘:**
```
PulseControl_SetFrequency(8500)
    â†“
íƒ€ì´ë¨¸ ì„¤ì •
    â†“
PWM ì‹ í˜¸ ìƒì„± (8500 Hz)
    â†“
ëª¨í„° ë“œë¼ì´ë²„ (L7)
    â†“
ì„œë³´ëª¨í„° íšŒì „! ğŸ”„

ì–‘ìˆ˜/ìŒìˆ˜ ì²˜ë¦¬:
// ì–‘ìˆ˜: ì •ë°©í–¥ íšŒì „
PulseControl_SetFrequency(5000);   // â†’

// ìŒìˆ˜: ì—­ë°©í–¥ íšŒì „
PulseControl_SetFrequency(-3000);  // â†

// 0: ì •ì§€
PulseControl_SetFrequency(0);      // â¸

## 8. ì•ˆì •í™” íŒë‹¨
// 7. ì•ˆì •í™” íŒë‹¨
    if (fabsf(state.error) < POSITION_TOLERANCE) {

fabsf() - ì ˆëŒ“ê°’:
fabsf(60.0f)   = 60.0f
fabsf(-60.0f)  = 60.0f
fabsf(0.5f)    = 0.5f

# POSITION_TOLERANCE:
- í—¤ë”íŒŒì¼ì— ì •ì˜ë˜ì–´ ìˆì„ ê²ƒ(#define POSITION_TOLERANCE 1.0f)
- í—ˆìš© ì˜¤ì°¨ ë²”ìœ„
ì¡°ê±´ ì˜ë¯¸ :
if (fabsf(state.error) < 1.0f) {
    // ì˜¤ì°¨ê°€ Â±1ë„ ì´ë‚´
}
ì˜ˆì‹œ :
error = 0.5Â°   â†’ fabsf(0.5) = 0.5 < 1.0  â†’ true  (ì•ˆì •!)
error = -0.8Â°  â†’ fabsf(-0.8) = 0.8 < 1.0 â†’ true  (ì•ˆì •!)
error = 2.0Â°   â†’ fabsf(2.0) = 2.0 < 1.0  â†’ false (ë¶ˆì•ˆì •)

ì•ˆì • ì‹œê°„ ëˆ„ì :
// ì˜¤ì°¨ê°€ ê³„ì† í—ˆìš© ë²”ìœ„ ë‚´ì— ìˆìœ¼ë©´
t=0ms:   stable_time_ms = 1
t=1ms:   stable_time_ms = 2
t=2ms:   stable_time_ms = 3
...
t=100ms: stable_time_ms = 101
ë‹¨ìœ„:
- stable_time_ms : ë³€ìˆ˜ëª…ì€ _msì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì¹´ìš´íŠ¸
- Update()ê°€ 1msë§ˆë‹¤ í˜¸ì¶œë˜ë¯€ë¡œ ì¹´ìš´íŠ¸ = ì‹œê°„(ms)

if (state.stable_time_ms > 100) {  // 100ms ì´ìƒ ì•ˆì •
            state.is_stable = true;
        }
```

**ì•ˆì • íŒë‹¨ ë¡œì§:**

**ì¡°ê±´:**
- ì˜¤ì°¨ê°€ Â±1ë„ ì´ë‚´ (í—ˆìš© ë²”ìœ„)
- 100ms ì´ìƒ ìœ ì§€

**ì™œ 100ms?**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‹œê°„ | ì˜¤ì°¨  | stable_time | ìƒíƒœ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0ms  | 50Â°   | 0           | ë¶ˆì•ˆì • â”‚
â”‚ 50ms | 5Â°    | 0           | ë¶ˆì•ˆì • â”‚
â”‚ 90ms | 0.5Â°  | 1           | ì§„ì…   â”‚
â”‚ 91ms | 0.3Â°  | 2           | ...    â”‚
â”‚ 189ms| 0.8Â°  | 100         | ...    â”‚
â”‚ 190ms| 0.7Â°  | 101 > 100   | ì•ˆì •! âœ…â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

100 msìœ ì§€ë˜ì–´ì•¼ ì•ˆì •í•˜ë‹¤ê³  íŒë‹¨í•˜ëŠ”ê²Œ ì˜³ì€ êµ¬ì¡°
ì˜¤ì°¨ ë²—ì–´ë‚˜ë©´ ë¦¬ì…‹
ì™œ ë¦¬ì…‹?
- ì™¸ë€(ë°©í•´ìš”ì¸) ë°œìƒ ì‹œ ë‹¤ì‹œ ì•ˆì •í™” í•„ìš”
- ì†ìœ¼ë¡œ ëª¨í„° ê±´ë“œë¦¼, ê°ì‘ìŠ¤ëŸ° ëª©í‘œ ë³€ê²½(ex)
